<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>文字粒子</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<canvas id="canvas" width="800" height="600"></canvas>
<div>
    <input type="text" id="text">
    <button id="shou">收</button>
    <button id="san">散</button>
</div>
<script src="js/utils.js"></script>
<script src="js/particles.js"></script>
<script src="js/check.js"></script>
<script type="text/javascript">
    window.onload = function () {
        var canvas = document.getElementById('canvas'),
                context = canvas.getContext('2d');
        var W = canvas.width,
                H = canvas.height,
                gridY = 8,
                gridX = 8;

        var isLine = false;

        var colors = [
            '#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5',
            '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50',
            '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800',
            '#FF5722'
        ];

        var particles = [];

        drawFont(W / 2, H / 2, '1');

        function drawFont(x, y, text) {
            context.clearRect(0, 0, canvas.width, canvas.height);

            particles.length = 0;

            context.textAlign = "center";
            context.font = "100px arial";
            context.fillText(text, x, y);

            var idata = context.getImageData(0, 0, W, H);
            var buffer32 = new Uint32Array(idata.data.buffer);

            for (var j = 0; j < H; j += gridY) {
                for (var i = 0; i < W; i += gridX) {
                    if (buffer32[j * W + i]) {
                        var size = 5,
                                color = Math.round(Math.random() * 15),   //大小
                                particle = new Particle(size, colors[color]);

                        particle.x = i;
                        particle.y = j;

                        particles.push(particle); //push进数组
                    }
                }
            }
            context.clearRect(0, 0, W, H);
            console.log(particles);
            particles.forEach(draw);
        }

        //绘制粒子
        function draw(particle) {
            particle.draw(context);
        }

//        (function drawFrame() {
//            window.requestAnimationFrame(drawFrame, canvas);
//
//            context.clearRect(0, 0, canvas.width, canvas.height);
//
//            particles.forEach(draw);
//        })();

        document.getElementById('shou').onclick = function () {
            var word = document.getElementById('text').value;
            drawFont(W / 2, H / 2, word);
        }
    }
</script>
</body>
</html>